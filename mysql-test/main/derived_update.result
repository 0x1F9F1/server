create table t1 (a int) engine=myisam;
insert into t1 values (3), (8), (7), (1), (4);
# full update of mergeable derived table dt1
explain update (select a from t1) as dt1 set a=10;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	
update (select a from t1) as dt1 set a=10;
select * from t1;
a
10
10
10
10
10
explain update (select * from t1) as dt1 set a=14;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	
update (select * from t1) as dt1 set a=14;
select * from t1;
a
14
14
14
14
14
# update with limit of mergeable dt1
explain update (select * from t1) as dt1 set dt1.a=18 limit 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	
update (select * from t1) as dt1 set dt1.a=18 limit 3;
select * from t1;
a
18
18
18
14
14
# partial update of mergeable dt1
explain update (select * from t1) as dt1 set dt1.a=2 where a < 18;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (select * from t1) as dt1 set dt1.a=2 where a < 18;
select * from t1;
a
18
18
18
2
2
# partial update of mergeable dt2 defined as
# full select from  mergeable derived table dt1
explain update (select * from (select * from t1) as d1t) as dt2
set dt2.a=22 where a > 16;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (select * from (select * from t1) as d1t) as dt2
set dt2.a=22 where a > 16;
select * from t1;
a
22
22
22
2
2
# full update of mergeable dt2 defined as
# partial select from  mergeable derived table dt1
explain update (select * from (select * from t1) as dt1 where dt1.a > 20) as dt2
set dt2.a=24;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (select * from (select * from t1) as dt1 where dt1.a > 20) as dt2
set dt2.a=24;
select * from t1;
a
24
24
24
2
2
update t1 set a=26 limit 1;
select * from t1;
a
26
24
24
2
2
# partial update of mergeable dt2 defined as
# partial select from  mergeable derived table dt1
explain update (select * from (select * from t1) as dt1 where dt1.a < 25) as dt2
set dt2.a=15 where dt2.a > 2;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (select * from (select * from t1) as dt1 where dt1.a < 25) as dt2
set dt2.a=15 where dt2.a > 2;
select * from t1;
a
26
15
15
2
2
create view v1 as select * from t1;
# partial update of mergeable dt1 defined as
# full select from mergeable view v1
explain update (select * from v1) dt1
set dt1.a=17 where dt1.a between 10 and 20;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (select * from v1) dt1
set dt1.a=17 where dt1.a between 10 and 20;
select * from t1;
a
26
17
17
2
2
# full update of mergeable dt1 defined as
# partial select from  mergeable view v1
explain update (select * from v1 where v1.a > 10) as dt1
set dt1.a=23;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (select * from v1 where v1.a > 10) as dt1
set dt1.a=23;
select * from t1;
a
23
23
23
2
2
update t1 set a=28 limit 1;
select * from t1;
a
28
23
23
2
2
# partial update of mergeable dt1 defined as
# partial select from  mergeable view v1
explain update (select * from v1 where v1.a < 27) as dt1
set dt1.a=19 where dt1.a > 2;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (select * from v1 where v1.a < 27) as dt1
set dt1.a=19 where dt1.a > 2;
select * from t1;
a
28
19
19
2
2
# partial update of mergeable dt1 defined as
# full select from mergeable embedded cte1
explain update (with cte1 as (select * from t1) select * from cte1) dt1
set dt1.a=11 where dt1.a between 10 and 20;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (with cte1 as (select * from t1) select * from cte1) dt1
set dt1.a=11 where dt1.a between 10 and 20;
select * from t1;
a
28
11
11
2
2
# full update of mergeable dt1 defined as
# partial select from  mergeable embedded cte1
explain update (with cte1 as (select * from t1)
select * from cte1 where cte1.a > 10) dt1
set dt1.a=21;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (with cte1 as (select * from t1)
select * from cte1 where cte1.a > 10) dt1
set dt1.a=21;
select * from t1;
a
21
21
21
2
2
update t1 set a=29 limit 1;
select * from t1;
a
29
21
21
2
2
# partial update of mergeable cte2 defined as
# partial select from  mergeable embedded cte1
explain update (with cte1 as (select * from t1)
select * from cte1 where cte1.a < 27) dt1
set dt1.a=13 where dt1.a > 2;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	5	Using where
update (with cte1 as (select * from t1)
select * from cte1 where cte1.a < 27) dt1
set dt1.a=13 where dt1.a > 2;
select * from t1;
a
29
13
13
2
2
drop view v1;
delete from t1;
insert into t1 values (3), (8), (7), (1), (4), (3), (5), (2);
# partial update of mergeable dt3 defined as
# partial select from  mergeable dt2 that uses mergeable dt1
explain update (select *
from (select *
from (select * from t1) dt1 where dt1.a > 1) dt2
where dt2.a < 8) dt3
set dt3.a=dt3.a+1
where dt3.a between 4 and 6;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
update (select *
from (select *
from (select * from t1) dt1 where dt1.a > 1) dt2
where dt2.a < 8) dt3
set dt3.a=dt3.a+1
where dt3.a between 4 and 6;
select * from t1;
a
3
8
7
1
5
3
6
2
# partial update of mergeable dt2 defined as
# partial select from  mergeable dt1 that uses mergeable cte1
explain update (select *
from (with cte1 as (select * from t1)
select * from cte1 where cte1.a < 8) dt1
where dt1.a > 1) dt2
set dt2.a=dt2.a-1
where dt2.a between 5 and 7;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
update (select *
from (with cte1 as (select * from t1)
select * from cte1 where cte1.a < 8) dt1
where dt1.a > 1) dt2
set dt2.a=dt2.a-1
where dt2.a between 5 and 7;
select * from t1;
a
3
8
6
1
4
3
5
2
# partial update of mergeable dt2 defined as
# partial select from  mergeable dt1 that uses mergeable view v1
create view v1 as select * from t1;
explain update (select *
from (select * from v1 where v1.a < 8) dt1
where dt1.a > 2) dt2
set dt2.a=dt2.a+1
where dt2.a between 2 and 5;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
update (select *
from (select * from v1 where v1.a < 8) dt1
where dt1.a > 2) dt2
set dt2.a=dt2.a+1
where dt2.a between 2 and 5;
select * from t1;
a
4
8
6
1
5
4
6
2
drop view v1;
# partial update of mergeable dt2 defined as
# partial select from  mergeable cte1 that uses mergeable dt1
explain update (with cte1 as
(select * from (select * from t1) dt1 where dt1.a > 2)
select * from cte1 where cte1.a < 6) dt2
set dt2.a=dt2.a-1
where dt2.a between 4 and 7;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
update (with cte1 as
(select * from (select * from t1) dt1 where dt1.a > 2)
select * from cte1 where cte1.a < 6) dt2
set dt2.a=dt2.a-1
where dt2.a between 4 and 7;
select * from t1;
a
3
8
6
1
4
3
6
2
# partial update of mergeable dt1 defined as
# partial select from  mergeable cte2 that uses mergeable cte1
explain update (with cte2 as
(with cte1 as (select * from t1)
select * from cte1 where cte1.a > 3)
select * from cte2 where cte2.a < 10) dt1
set dt1.a=dt1.a+1
where dt1.a between 4 and 7;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
update (with cte2 as
(with cte1 as (select * from t1)
select * from cte1 where cte1.a > 3)
select * from cte2 where cte2.a < 10) dt1
set dt1.a=dt1.a+1
where dt1.a between 4 and 7;
select * from t1;
a
3
8
7
1
5
3
7
2
# partial update of mergeable dt1 defined as
# partial select from  mergeable cte1 that uses mergeable v1
create view v1 as select a from t1;
explain update (with cte1 as
(select * from v1 where v1.a > 1)
select * from cte1 where cte1.a < 7) dt1
set dt1.a=dt1.a-1
where dt1.a between 2 and 4;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
update (with cte1 as
(select * from v1 where v1.a > 1)
select * from cte1 where cte1.a < 7) dt1
set dt1.a=dt1.a-1
where dt1.a between 2 and 4;
select * from t1;
a
2
8
7
1
5
2
7
1
drop view v1;
# partial update of mergeable dt2 defined as
# partial select from  mergeable v1 that uses mergeable dt1
create view v1 as select * from (select * from t1) dt1 where dt1.a > 2;
explain update (select * from v1 where v1.a < 6) dt2
set dt2.a=dt2.a+1
where dt2.a between 4 and 5;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
update (select * from v1 where v1.a < 6) dt2
set dt2.a=dt2.a+1
where dt2.a between 4 and 5;
select * from t1;
a
2
8
7
1
6
2
7
1
drop view v1;
# partial update of mergeable dt1 defined as
# partial select from  mergeable v1 that uses mergeable cte1
create view v1 as
with cte1 as (select * from t1) select * from cte1 where cte1.a > 1;
explain update (select * from v1 where v1.a < 6) dt1
set dt1.a=dt1.a-1
where dt1.a between 2 and 5;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
update (select * from v1 where v1.a < 6) dt1
set dt1.a=dt1.a-1
where dt1.a between 2 and 5;
select * from t1;
a
1
8
7
1
6
1
7
1
drop view v1;
# partial update of mergeable dt1 defined as
# partial select from  mergeable v2 that uses mergeable v1
create view v1 as select a from t1;
create view v2 as select * from v1 where v1.a > 3;
explain update (select * from v2 where v2.a < 8) dt1
set dt1.a=dt1.a+1
where dt1.a between 5 and 10;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
update (select * from v2 where v2.a < 8) dt1
set dt1.a=dt1.a+1
where dt1.a between 5 and 10;
select * from t1;
a
1
8
8
1
7
1
8
1
drop view v2;
drop view v1;
drop table t1;
