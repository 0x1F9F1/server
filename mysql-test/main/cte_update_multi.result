create table t1 (a int) engine=myisam;
create table t2 (b int) engine=myisam;
create table t3 (c int, d int) engine=myisam;
insert into t1 values (3), (8), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (10), (3), (9), (2), (2), (4), (6), (1);
select * from t1;
a
3
8
7
1
4
3
5
2
select * from t2;
b
5
10
3
9
2
2
4
6
1
# multi-table update of mergeable cte1
# and mergeable derived table dt1
explain with cte1 as (select a from t1 where a > 1)
select * from cte1, (select b from t2 where b < 6) as dt1
where cte1.a=dt1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
with cte1 as (select a from t1 where a > 1)
select * from cte1, (select b from t2 where b < 6) as dt1
where cte1.a=dt1.b;
a	b
5	5
3	3
3	3
2	2
2	2
4	4
explain with cte1 as (select a from t1 where a > 1)
update cte1, (select b from t2 where b < 6) as dt1
set a=a+1, b=b+1 where cte1.a=dt1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
with cte1 as (select a from t1 where a > 1)
update cte1, (select b from t2 where b < 6) as dt1
set a=a+1, b=b+1 where cte1.a=dt1.b;
select * from t1;
a
4
8
7
1
5
4
6
3
select * from t2;
b
6
10
4
9
3
3
5
6
1
# multi-table update of mergeable cte1
# and mergeable cte2
explain with
cte1 as (select a from t1 where a > 1),
cte2 as (select * from t2 where b < 9)
select * from cte1, cte2 where cte1.a=cte2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
with
cte1 as (select a from t1 where a > 1),
cte2 as (select * from t2 where b < 9)
select * from cte1, cte2 where cte1.a=cte2.b;
a	b
6	6
4	4
4	4
3	3
3	3
5	5
6	6
explain with
cte1 as (select a from t1 where a > 1),
cte2 as (select * from t2 where b < 9)
update cte1, cte2
set cte1.a=cte1.a-1, cte2.b=cte2.b-1 where cte1.a=cte2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
with
cte1 as (select a from t1 where a > 1),
cte2 as (select * from t2 where b < 9)
update cte1, cte2
set cte1.a=cte1.a-1, cte2.b=cte2.b-1 where cte1.a=cte2.b;
select * from t1;
a
3
8
7
1
4
3
5
2
select * from t2;
b
5
10
3
9
2
2
4
5
1
# multi-table update of mergeable cte1
# and mergeable view v1
create view v1 as select * from t2 where b < 5;
explain with cte1 as (select a from t1 where a > 1)
select * from cte1, v1 where cte1.a=v1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
with cte1 as (select a from t1 where a > 1)
select * from cte1, v1 where cte1.a=v1.b;
a	b
3	3
3	3
2	2
2	2
4	4
explain with cte1 as (select a from t1 where a > 1)
update cte1, v1
set cte1.a=cte1.a+2, v1.b=v1.b+2 where cte1.a=v1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
with cte1 as (select a from t1 where a > 1)
update cte1, v1
set cte1.a=cte1.a+2, v1.b=v1.b+2 where cte1.a=v1.b;
select * from t1;
a
5
8
7
1
6
5
5
4
select * from t2;
b
5
10
5
9
4
4
6
5
1
drop view v1;
delete from t1;
delete from t2;
insert into t1 values (3), (8), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (10), (3), (9), (2), (2), (4), (6), (1);
select * from t1;
a
3
8
7
1
4
3
5
2
select * from t2;
b
5
10
3
9
2
2
4
6
1
# multi-table update of mergeable cte1
# and non-mergeable derived table dt1
explain with cte1 as (select a from t1 where a > 1)
select * from cte1, (select b from t2 where b < 6 group by b) as dt1
where cte1.a=dt1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select a from t1 where a > 1)
select * from cte1, (select b from t2 where b < 6 group by b) as dt1
where cte1.a=dt1.b;
a	b
3	3
4	4
3	3
5	5
2	2
explain with cte1 as (select a from t1 where a > 1)
update cte1, (select b from t2 where b < 6 group by b) as dt1
set a=a+1 where cte1.a=dt1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select a from t1 where a > 1)
update cte1, (select b from t2 where b < 6 group by b) as dt1
set a=a+1 where cte1.a=dt1.b;
select * from t1;
a
4
8
7
1
5
4
6
3
select * from t2;
b
5
10
3
9
2
2
4
6
1
# multi-table update of mergeable cte1
# and non-mergeable cte2
explain with cte1 as (select a from t1 where a > 1),
cte2 as (select * from t2 where b < 9 group by b)
select * from cte1, cte2 where cte1.a=cte2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select a from t1 where a > 1),
cte2 as (select * from t2 where b < 9 group by b)
select * from cte1, cte2 where cte1.a=cte2.b;
a	b
4	4
5	5
4	4
6	6
3	3
explain with cte1 as (select a from t1 where a > 1),
cte2 as (select * from t2 where b < 9 group by b)
update cte1, cte2
set cte1.a=cte1.a-1 where cte1.a=cte2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select a from t1 where a > 1),
cte2 as (select * from t2 where b < 9 group by b)
update cte1, cte2
set cte1.a=cte1.a-1 where cte1.a=cte2.b;
select * from t1;
a
3
8
7
1
4
3
5
2
select * from t2;
b
5
10
3
9
2
2
4
6
1
# multi-table update of mergeable cte1
# and non-mergeable view v1
create view v1 as select * from t2 where b < 5 group by b;
explain with cte1 as (select a from t1 where a > 1)
select * from cte1, v1 where cte1.a=v1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select a from t1 where a > 1)
select * from cte1, v1 where cte1.a=v1.b;
a	b
3	3
4	4
3	3
2	2
explain with cte1 as (select a from t1 where a > 1)
update cte1, v1
set cte1.a=cte1.a+2 where cte1.a=v1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select a from t1 where a > 1)
update cte1, v1
set cte1.a=cte1.a+2 where cte1.a=v1.b;
select * from t1;
a
5
8
7
1
6
5
5
4
select * from t2;
b
5
10
3
9
2
2
4
6
1
drop view v1;
delete from t1;
delete from t2;
insert into t1 values (3), (8), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (10), (3), (9), (2), (2), (4), (6), (1);
# update of mergeable cte1 specified as join of
# mergeable derived table dt1 and mergeable derived table dt2
explain with cte1 as
(select * from
(select a from t1 where a > 1) as dt1,
(select b from t2 where b < 6) as dt2
where dt1.a=dt2.b)
update cte1
set cte1.a=cte1.a+1, cte1.b=cte1.b+1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
with cte1 as
(select * from
(select a from t1 where a > 1) as dt1,
(select b from t2 where b < 6) as dt2
where dt1.a=dt2.b)
update cte1
set cte1.a=cte1.a+1, cte1.b=cte1.b+1;
select * from t1;
a
4
8
7
1
5
4
6
3
select * from t2;
b
6
10
4
9
3
3
5
6
1
# update of mergeable cte2 specified as join of
# mergeable derived table dt1 and mergeable cte1
explain with cte2 as
(with cte1 as (select b from t2 where b < 9)
select * from
(select a from t1 where a > 1) as dt1, cte1
where dt1.a=cte1.b)
update cte2
set cte2.a=cte2.a-1, cte2.b=cte2.b-1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
with cte2 as
(with cte1 as (select b from t2 where b < 9)
select * from
(select a from t1 where a > 1) as dt1, cte1
where dt1.a=cte1.b)
update cte2
set cte2.a=cte2.a-1, cte2.b=cte2.b-1;
select * from t1;
a
3
8
7
1
4
3
5
2
select * from t2;
b
5
10
3
9
2
2
4
5
1
# update of mergeable cte1 specified as join of
# mergeable derived table dt1 and mergeable view v1
create view v1 as select b from t2 where b < 5;
explain with cte1 as
(select * from
(select a from t1 where a > 1) as dt1, v1
where dt1.a=v1.b)
update cte1
set cte1.a=cte1.a+1, cte1.b=cte1.b+1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
with cte1 as
(select * from
(select a from t1 where a > 1) as dt1, v1
where dt1.a=v1.b)
update cte1
set cte1.a=cte1.a+1, cte1.b=cte1.b+1;
select * from t1;
a
4
8
7
1
5
4
5
3
select * from t2;
b
5
10
4
9
3
3
5
5
1
drop view v1;
# update of mergeable cte3 specified as join of
# mergeable cte1 and mergeable cte2
explain with cte3 as
(with cte1 as (select a from t1 where a > 1),
cte2 as (select b from t2 where b < 6)
select * from cte1, cte2 where cte1.a=cte2.b)
update cte3
set cte3.a=cte3.a-1, cte3.b=cte3.b-1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
with cte3 as
(with cte1 as (select a from t1 where a > 1),
cte2 as (select b from t2 where b < 6)
select * from cte1, cte2 where cte1.a=cte2.b)
update cte3
set cte3.a=cte3.a-1, cte3.b=cte3.b-1;
select * from t1;
a
3
8
7
1
4
3
4
2
select * from t2;
b
4
10
3
9
2
2
4
4
1
# update of mergeable cte2 specified as join of
# mergeable cte1 and mergeable view v1
create view v1 as select b from t2 where b < 5;
explain with cte2 as
(with cte1 as (select a from t1 where a > 1)
select * from cte1, v1 where cte1.a=v1.b)
update cte2
set cte2.a=cte2.a+1, cte2.b=cte2.b+1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
with cte2 as
(with cte1 as (select a from t1 where a > 1)
select * from cte1, v1 where cte1.a=v1.b)
update cte2
set cte2.a=cte2.a+1, cte2.b=cte2.b+1;
select * from t1;
a
4
8
7
1
5
4
5
3
select * from t2;
b
5
10
4
9
3
3
5
5
1
drop view v1;
# update of mergeable cte1 specified as join of
# mergeable view v1 and mergeable view v2
create view v1 as select a from t1 where a > 1;
create view v2 as select b from t2 where b < 5;
explain with cte1 as
(select * from v1, v2 where v1.a=v2.b)
update cte1
set cte1.a=cte1.a-1, cte1.b=cte1.b-1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
with cte1 as
(select * from v1, v2 where v1.a=v2.b)
update cte1
set cte1.a=cte1.a-1, cte1.b=cte1.b-1;
select * from t1;
a
3
8
7
1
5
3
5
2
select * from t2;
b
5
10
3
9
2
2
5
5
1
drop view v1;
drop view v2;
delete from t1;
delete from t2;
insert into t1 values (3), (8), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (10), (3), (9), (2), (2), (4), (6), (1);
# update of mergeable cte1 specified as join of
# mergeable derived table dt1 and non-mergeable derived table dt2
explain with cte1 as
(select * from
(select a from t1 where a > 1) as dt1,
(select b from t2 where b < 6 group by b) as dt2
where dt1.a=dt2.b)
update cte1
set cte1.a=cte1.a+1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as
(select * from
(select a from t1 where a > 1) as dt1,
(select b from t2 where b < 6 group by b) as dt2
where dt1.a=dt2.b)
update cte1
set cte1.a=cte1.a+1;
select * from t1;
a
4
8
7
1
5
4
6
3
select * from t2;
b
5
10
3
9
2
2
4
6
1
# update of mergeable cte2 specified as join of
# mergeable derived table dt1 and non-mergeable cte1
explain with cte2 as
(with cte1 as (select b from t2 where b < 9 group by b)
select * from
(select a from t1 where a > 1) as dt1, cte1
where dt1.a=cte1.b)
update cte2
set cte2.a=cte2.a-1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived2>	ref	key0	key0	5	test.t1.a	2	
2	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte2 as
(with cte1 as (select b from t2 where b < 9 group by b)
select * from
(select a from t1 where a > 1) as dt1, cte1
where dt1.a=cte1.b)
update cte2
set cte2.a=cte2.a-1;
select * from t1;
a
3
8
7
1
4
3
5
2
select * from t2;
b
5
10
3
9
2
2
4
6
1
# update of mergeable cte1 specified as join of
# mergeable derived table dt1 and non-mergeable view v1
create view v1 as select b from t2 where b < 5 group by b;
explain with cte1 as
(select * from
(select a from t1 where a > 1) as dt1, v1
where dt1.a=v1.b)
update cte1
set cte1.a=cte1.a+1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as
(select * from
(select a from t1 where a > 1) as dt1, v1
where dt1.a=v1.b)
update cte1
set cte1.a=cte1.a+1;
select * from t1;
a
4
8
7
1
5
4
5
3
select * from t2;
b
5
10
3
9
2
2
4
6
1
drop view v1;
# update of mergeable cte2 specified as join of
# mergeable cte1 and non-mergeable dt1
explain with cte2 as
(with cte1 as (select a from t1 where a > 1)
select * from
cte1, (select b from t2 where b < 7 group by b) dt1
where cte1.a=dt1.b)
update cte2
set cte2.a=cte2.a-1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte2 as
(with cte1 as (select a from t1 where a > 1)
select * from
cte1, (select b from t2 where b < 7 group by b) dt1
where cte1.a=dt1.b)
update cte2
set cte2.a=cte2.a-1;
select * from t1;
a
3
8
7
1
4
3
4
2
select * from t2;
b
5
10
3
9
2
2
4
6
1
# update of mergeable cte3 specified as join of
# mergeable cte1 and non-mergeable cte2
explain with cte3 as
(with cte1 as (select a from t1 where a > 1),
cte2 as (select b from t2 where b < 6 group by b)
select * from cte1, cte2 where cte1.a=cte2.b)
update cte3
set cte3.a=cte3.a+1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte3 as
(with cte1 as (select a from t1 where a > 1),
cte2 as (select b from t2 where b < 6 group by b)
select * from cte1, cte2 where cte1.a=cte2.b)
update cte3
set cte3.a=cte3.a+1;
select * from t1;
a
4
8
7
1
5
4
5
3
select * from t2;
b
5
10
3
9
2
2
4
6
1
# update of mergeable cte2 specified as join of
# mergeable cte1 and non-mergeable view v1
create view v1 as select b from t2 where b < 7 group by b;
explain with cte2 as
(with cte1 as (select a from t1 where a > 1)
select * from cte1, v1 where cte1.a=v1.b)
update cte2
set cte2.a=cte2.a-1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte2 as
(with cte1 as (select a from t1 where a > 1)
select * from cte1, v1 where cte1.a=v1.b)
update cte2
set cte2.a=cte2.a-1;
select * from t1;
a
3
8
7
1
4
3
4
2
select * from t2;
b
5
10
3
9
2
2
4
6
1
drop view v1;
# update of mergeable cte1 specified as join of
# mergeable view v1 and non-mergeable derived table dt1
create view v1 as select a from t1 where a > 1;
explain with cte1 as
(select * from
v1, (select b from t2 where b < 6 group by b) dt1
where v1.a=dt1.b)
update cte1
set cte1.a=cte1.a+1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as
(select * from
v1, (select b from t2 where b < 6 group by b) dt1
where v1.a=dt1.b)
update cte1
set cte1.a=cte1.a+1;
select * from t1;
a
4
8
7
1
5
4
5
3
select * from t2;
b
5
10
3
9
2
2
4
6
1
drop view v1;
# update of mergeable cte2 specified as join of
# mergeable view v1 and non-mergeable cte1
create view v1 as select a from t1 where a > 1;
explain with cte2 as
(with cte1 as (select b from t2 where b < 7 group by b)
select * from v1, cte1 where v1.a=cte1.b)
update cte2
set cte2.a=cte2.a-1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived2>	ref	key0	key0	5	test.t1.a	2	
2	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte2 as
(with cte1 as (select b from t2 where b < 7 group by b)
select * from v1, cte1 where v1.a=cte1.b)
update cte2
set cte2.a=cte2.a-1;
select * from t1;
a
3
8
7
1
4
3
4
2
select * from t2;
b
5
10
3
9
2
2
4
6
1
drop view v1;
# update of mergeable cte1 specified as join of
# mergeable view v1 and non-mergeable view v2
create view v1 as select a from t1 where a > 1;
create view v2 as select b from t2 where b < 5 group by b;
explain with cte1 as
(select * from v1, v2 where v1.a=v2.b)
update cte1
set cte1.a=cte1.a+1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as
(select * from v1, v2 where v1.a=v2.b)
update cte1
set cte1.a=cte1.a+1;
select * from t1;
a
4
8
7
1
5
4
5
3
select * from t2;
b
5
10
3
9
2
2
4
6
1
drop view v1;
drop view v2;
delete from t1;
delete from t2;
delete from t3;
insert into t1 values (3), (6), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (7), (3), (9), (2), (2), (4), (6), (1);
insert into t3 values
(4,2), (9,3), (2,1), (3,1), (2,3), (7,1), (1,1), (4,1), (5,2), (6,1);
select * from t1;
a
3
6
7
1
4
3
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
3	1
2	3
7	1
1	1
4	1
5	2
6	1
# update of join of mergeable cte1,
# mergeable derived table dt1 and mergeable derived table dt2
explain with cte1 as (select * from t1 where t1.a > 2)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 5) dt1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt2
where cte1.a=dt1.b and dt1.b=dt2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (incremental, BNL join)
with cte1 as (select * from t1 where t1.a > 2)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 5) dt1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt2
where cte1.a=dt1.b and dt1.b=dt2.c;
a	b	c	d1
3	3	3	2
3	3	3	2
4	4	4	2
explain with cte1 as (select * from t1 where t1.a > 2)
update
cte1,
(select * from t2 where t2.b < 5) dt1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt2
set cte1.a=cte1.a+1, dt1.b=dt1.b+1, dt2.c=dt2.c-dt2.d1
where cte1.a=dt1.b and dt1.b=dt2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
with cte1 as (select * from t1 where t1.a > 2)
update
cte1,
(select * from t2 where t2.b < 5) dt1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt2
set cte1.a=cte1.a+1, dt1.b=dt1.b+1, dt2.c=dt2.c-dt2.d1
where cte1.a=dt1.b and dt1.b=dt2.c;
select * from t1;
a
4
6
7
1
5
4
5
2
select * from t2;
b
5
7
4
9
2
2
5
6
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
7	1
1	1
2	1
5	2
6	1
# update of join of mergeable cte1,
# mergeable derived table dt1 and mergeable cte2
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 10) dt1,
cte2
where cte1.a=dt1.b and dt1.b=cte2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (incremental, BNL join)
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 10) dt1,
cte2
where cte1.a=dt1.b and dt1.b=cte2.c;
a	b	c	d1
7	7	7	2
6	6	6	2
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
(select * from t2 where t2.b < 10) dt1,
cte2
set cte1.a=cte1.a-1, dt1.b=dt1.b-1, cte2.c=cte2.c+cte2.d1
where cte1.a=dt1.b and dt1.b=cte2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
(select * from t2 where t2.b < 10) dt1,
cte2
set cte1.a=cte1.a-1, dt1.b=dt1.b-1, cte2.c=cte2.c+cte2.d1
where cte1.a=dt1.b and dt1.b=cte2.c;
select * from t1;
a
4
5
6
1
5
4
5
2
select * from t2;
b
5
6
4
9
2
2
5
5
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
9	1
1	1
2	1
5	2
8	1
# update of join of mergeable cte1,
# mergeable derived table dt1 and mergeable view v1
create view v1 as select c, d+1 as d1 from t3 where t3.d in (1,2);
explain with cte1 as (select * from t1 where t1.a < 3)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 5) dt1,
v1
where cte1.a=dt1.b and dt1.b=v1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (incremental, BNL join)
with cte1 as (select * from t1 where t1.a < 3)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 5) dt1,
v1
where cte1.a=dt1.b and dt1.b=v1.c;
a	b	c	d1
2	2	2	2
2	2	2	2
1	1	1	2
1	1	1	2
2	2	2	2
2	2	2	2
explain with cte1 as (select * from t1 where t1.a < 3)
update
cte1,
(select * from t2 where t2.b < 5) dt1,
v1
set cte1.a=cte1.a+1, dt1.b=dt1.b+1, v1.c=v1.c+v1.d1
where cte1.a=dt1.b and dt1.b=v1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
with cte1 as (select * from t1 where t1.a < 3)
update
cte1,
(select * from t2 where t2.b < 5) dt1,
v1
set cte1.a=cte1.a+1, dt1.b=dt1.b+1, v1.c=v1.c+v1.d1
where cte1.a=dt1.b and dt1.b=v1.c;
select * from t1;
a
4
5
6
2
5
4
5
3
select * from t2;
b
5
6
4
9
3
3
5
5
2
select * from t3;
c	d
4	2
9	3
4	1
3	1
2	3
9	1
3	1
4	1
5	2
8	1
drop view v1;
delete from t1;
delete from t2;
delete from t3;
insert into t1 values (3), (6), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (7), (3), (9), (2), (2), (4), (6), (1);
insert into t3 values
(4,2), (9,3), (2,1), (3,1), (2,3), (7,1), (1,1), (4,1), (5,2), (6,1);
select * from t1;
a
3
6
7
1
4
3
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
3	1
2	3
7	1
1	1
4	1
5	2
6	1
# update of join of mergeable cte1,
# mergeable cte2 and mergeable derived table dt1
explain with
cte1 as (select * from t1 where t1.a > 2),
cte2 as (select * from t2 where t2.b < 5)
select a,b,c,d1 from
cte1,
cte2,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
where cte1.a=cte2.b and cte2.b=dt1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (incremental, BNL join)
with
cte1 as (select * from t1 where t1.a > 2),
cte2 as (select * from t2 where t2.b < 5)
select a,b,c,d1 from
cte1,
cte2,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
where cte1.a=cte2.b and cte2.b=dt1.c;
a	b	c	d1
3	3	3	2
3	3	3	2
4	4	4	2
explain with
cte1 as (select * from t1 where t1.a > 2),
cte2 as (select * from t2 where t2.b < 5)
update
cte1,
cte2,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
set cte1.a=cte1.a+1, cte2.b=cte2.b+1, dt1.c=dt1.c-dt1.d1
where cte1.a=cte2.b and cte2.b=dt1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
with
cte1 as (select * from t1 where t1.a > 2),
cte2 as (select * from t2 where t2.b < 5)
update
cte1,
cte2,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
set cte1.a=cte1.a+1, cte2.b=cte2.b+1, dt1.c=dt1.c-dt1.d1
where cte1.a=cte2.b and cte2.b=dt1.c;
select * from t1;
a
4
6
7
1
5
4
5
2
select * from t2;
b
5
7
4
9
2
2
5
6
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
7	1
1	1
2	1
5	2
6	1
# update of join of mergeable cte1,
# mergeable cte2 and mergeable cte3
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select * from t2 where t2.b < 10),
cte3 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
cte2,
cte3
where cte1.a=cte2.b and cte2.b=cte3.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (incremental, BNL join)
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select * from t2 where t2.b < 10),
cte3 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
cte2,
cte3
where cte1.a=cte2.b and cte2.b=cte3.c;
a	b	c	d1
7	7	7	2
6	6	6	2
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select * from t2 where t2.b < 10),
cte3 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
cte2,
cte3
set cte1.a=cte1.a-1, cte2.b=cte2.b-1, cte3.c=cte3.c+cte3.d1
where cte1.a=cte2.b and cte2.b=cte3.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select * from t2 where t2.b < 10),
cte3 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
cte2,
cte3
set cte1.a=cte1.a-1, cte2.b=cte2.b-1, cte3.c=cte3.c+cte3.d1
where cte1.a=cte2.b and cte2.b=cte3.c;
select * from t1;
a
4
5
6
1
5
4
5
2
select * from t2;
b
5
6
4
9
2
2
5
5
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
9	1
1	1
2	1
5	2
8	1
# update of join of mergeable cte1,
# mergeable cte2 and mergeable view v1
create view v1 as select c, d+1 as d1 from t3 where t3.d in (1,2);
explain with
cte1 as (select * from t1 where t1.a < 3),
cte2 as (select * from t2 where t2.b < 5)
select a,b,c,d1 from
cte1,
cte2,
v1
where cte1.a=cte2.b and cte2.b=v1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (incremental, BNL join)
with
cte1 as (select * from t1 where t1.a < 3),
cte2 as (select * from t2 where t2.b < 5)
select a,b,c,d1 from
cte1,
cte2,
v1
where cte1.a=cte2.b and cte2.b=v1.c;
a	b	c	d1
2	2	2	2
2	2	2	2
1	1	1	2
1	1	1	2
2	2	2	2
2	2	2	2
explain with
cte1 as (select * from t1 where t1.a < 3),
cte2 as (select * from t2 where t2.b < 5)
update
cte1,
cte2,
v1
set cte1.a=cte1.a+1, cte2.b=cte2.b+1, v1.c=v1.c+v1.d1
where cte1.a=cte2.b and cte2.b=v1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
with
cte1 as (select * from t1 where t1.a < 3),
cte2 as (select * from t2 where t2.b < 5)
update
cte1,
cte2,
v1
set cte1.a=cte1.a+1, cte2.b=cte2.b+1, v1.c=v1.c+v1.d1
where cte1.a=cte2.b and cte2.b=v1.c;
select * from t1;
a
4
5
6
2
5
4
5
3
select * from t2;
b
5
6
4
9
3
3
5
5
2
select * from t3;
c	d
4	2
9	3
4	1
3	1
2	3
9	1
3	1
4	1
5	2
8	1
drop view v1;
delete from t1;
delete from t2;
delete from t3;
insert into t1 values (3), (6), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (7), (3), (9), (2), (2), (4), (6), (1);
insert into t3 values
(4,2), (9,3), (2,1), (3,1), (2,3), (7,1), (1,1), (4,1), (5,2), (6,1);
select * from t1;
a
3
6
7
1
4
3
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
3	1
2	3
7	1
1	1
4	1
5	2
6	1
# update of join of mergeable cte1,
# mergeable view v1 and mergeable derived table dt1
create view v1 as (select * from t2 where t2.b < 5);
explain with cte1 as (select * from t1 where t1.a > 2)
select a,b,c,d1 from
cte1,
v1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
where cte1.a=v1.b and v1.b=dt1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (incremental, BNL join)
with cte1 as (select * from t1 where t1.a > 2)
select a,b,c,d1 from
cte1,
v1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
where cte1.a=v1.b and v1.b=dt1.c;
a	b	c	d1
3	3	3	2
3	3	3	2
4	4	4	2
explain with cte1 as (select * from t1 where t1.a > 2)
update
cte1,
v1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
set cte1.a=cte1.a+1, v1.b=v1.b+1, dt1.c=dt1.c-dt1.d1
where cte1.a=v1.b and v1.b=dt1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
with cte1 as (select * from t1 where t1.a > 2)
update
cte1,
v1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
set cte1.a=cte1.a+1, v1.b=v1.b+1, dt1.c=dt1.c-dt1.d1
where cte1.a=v1.b and v1.b=dt1.c;
select * from t1;
a
4
6
7
1
5
4
5
2
select * from t2;
b
5
7
4
9
2
2
5
6
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
7	1
1	1
2	1
5	2
6	1
drop view v1;
# update of join of mergeable cte1,
# mergeable view v1 and mergeable cte2
create view v1 as select * from t2 where t2.b < 10;
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
v1,
cte2
where cte1.a=v1.b and v1.b=cte2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (incremental, BNL join)
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
v1,
cte2
where cte1.a=v1.b and v1.b=cte2.c;
a	b	c	d1
7	7	7	2
6	6	6	2
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
v1,
cte2
set cte1.a=cte1.a-1, v1.b=v1.b-1, cte2.c=cte2.c+cte2.d1
where cte1.a=v1.b and v1.b=cte2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
v1,
cte2
set cte1.a=cte1.a-1, v1.b=v1.b-1, cte2.c=cte2.c+cte2.d1
where cte1.a=v1.b and v1.b=cte2.c;
select * from t1;
a
4
5
6
1
5
4
5
2
select * from t2;
b
5
6
4
9
2
2
5
5
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
9	1
1	1
2	1
5	2
8	1
drop view v1;
# update of join of mergeable cte1,
# mergeable view v1 and mergeable view v2
create view v1 as select * from t2 where t2.b < 5;
create view v2 as select c, d+1 as d1 from t3 where t3.d in (1,2);
explain with cte1 as (select * from t1 where t1.a < 3)
select a,b,c,d1 from
cte1,
v1,
v2
where cte1.a=v1.b and v1.b=v2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using join buffer (flat, BNL join)
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (incremental, BNL join)
with cte1 as (select * from t1 where t1.a < 3)
select a,b,c,d1 from
cte1,
v1,
v2
where cte1.a=v1.b and v1.b=v2.c;
a	b	c	d1
2	2	2	2
2	2	2	2
1	1	1	2
1	1	1	2
2	2	2	2
2	2	2	2
explain with cte1 as (select * from t1 where t1.a < 3)
update
cte1,
v1,
v2
set cte1.a=cte1.a+1, v1.b=v1.b+1, v2.c=v2.c+v2.d1
where cte1.a=v1.b and v1.b=v2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	9	Using where
1	SIMPLE	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
with cte1 as (select * from t1 where t1.a < 3)
update
cte1,
v1,
v2
set cte1.a=cte1.a+1, v1.b=v1.b+1, v2.c=v2.c+v2.d1
where cte1.a=v1.b and v1.b=v2.c;
select * from t1;
a
4
5
6
2
5
4
5
3
select * from t2;
b
5
6
4
9
3
3
5
5
2
select * from t3;
c	d
4	2
9	3
4	1
3	1
2	3
9	1
3	1
4	1
5	2
8	1
drop view v1;
drop view v2;
delete from t1;
delete from t2;
delete from t3;
insert into t1 values (3), (6), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (7), (3), (9), (2), (2), (4), (6), (1);
insert into t3 values
(4,2), (9,3), (2,1), (3,1), (2,3), (7,1), (1,1), (4,1), (5,2), (6,1);
select * from t1;
a
3
6
7
1
4
3
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
3	1
2	3
7	1
1	1
4	1
5	2
6	1
# update of join of mergeable cte1,
# non-mergeable derived table dt1 and mergeable derived table dt2
explain with cte1 as (select * from t1 where t1.a > 2)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 5 group by b) dt1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt2
where cte1.a=dt1.b and dt1.b=dt2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (flat, BNL join)
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select * from t1 where t1.a > 2)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 5 group by b) dt1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt2
where cte1.a=dt1.b and dt1.b=dt2.c;
a	b	c	d1
3	3	3	2
3	3	3	2
4	4	4	2
explain with cte1 as (select * from t1 where t1.a > 2)
update
cte1,
(select * from t2 where t2.b < 5 group by b) dt1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt2
set cte1.a=cte1.a+1, dt2.c=dt2.c-dt2.d1
where cte1.a=dt1.b and dt1.b=dt2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select * from t1 where t1.a > 2)
update
cte1,
(select * from t2 where t2.b < 5 group by b) dt1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt2
set cte1.a=cte1.a+1, dt2.c=dt2.c-dt2.d1
where cte1.a=dt1.b and dt1.b=dt2.c;
select * from t1;
a
4
6
7
1
5
4
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
7	1
1	1
2	1
5	2
6	1
# update of join of mergeable cte1,
# non-mergeable derived table dt1 and mergeable cte2
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 10 group by b) dt1,
cte2
where cte1.a=dt1.b and dt1.b=cte2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (flat, BNL join)
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 10 group by b) dt1,
cte2
where cte1.a=dt1.b and dt1.b=cte2.c;
a	b	c	d1
7	7	7	2
6	6	6	2
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
(select * from t2 where t2.b < 10 group by b) dt1,
cte2
set cte1.a=cte1.a-1, cte2.c=cte2.c+cte2.d1
where cte1.a=dt1.b and dt1.b=cte2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
(select * from t2 where t2.b < 10 group by b) dt1,
cte2
set cte1.a=cte1.a-1, cte2.c=cte2.c+cte2.d1
where cte1.a=dt1.b and dt1.b=cte2.c;
select * from t1;
a
4
5
6
1
5
4
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
9	1
1	1
2	1
5	2
8	1
# update of join of mergeable cte1,
# non-mergeable derived table dt1 and mergeable view v1
create view v1 as select c, d+1 as d1 from t3 where t3.d in (1,2);
explain with cte1 as (select * from t1 where t1.a < 3)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 5 group by b) dt1,
v1
where cte1.a=dt1.b and dt1.b=v1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (flat, BNL join)
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select * from t1 where t1.a < 3)
select a,b,c,d1 from
cte1,
(select * from t2 where t2.b < 5 group by b) dt1,
v1
where cte1.a=dt1.b and dt1.b=v1.c;
a	b	c	d1
2	2	2	2
1	1	1	2
1	1	1	2
2	2	2	2
explain with cte1 as (select * from t1 where t1.a < 3)
update
cte1,
(select * from t2 where t2.b < 5 group by b) dt1,
v1
set cte1.a=cte1.a+1, v1.c=v1.c+v1.d1
where cte1.a=dt1.b and dt1.b=v1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select * from t1 where t1.a < 3)
update
cte1,
(select * from t2 where t2.b < 5 group by b) dt1,
v1
set cte1.a=cte1.a+1, v1.c=v1.c+v1.d1
where cte1.a=dt1.b and dt1.b=v1.c;
select * from t1;
a
4
5
6
2
5
4
5
3
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
4	1
3	1
2	3
9	1
3	1
4	1
5	2
8	1
drop view v1;
delete from t1;
delete from t2;
delete from t3;
insert into t1 values (3), (6), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (7), (3), (9), (2), (2), (4), (6), (1);
insert into t3 values
(4,2), (9,3), (2,1), (3,1), (2,3), (7,1), (1,1), (4,1), (5,2), (6,1);
select * from t1;
a
3
6
7
1
4
3
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
3	1
2	3
7	1
1	1
4	1
5	2
6	1
# update of join of mergeable cte1,
# non-mergeable cte2 and mergeable derived table dt1
explain with
cte1 as (select * from t1 where t1.a > 2),
cte2 as (select * from t2 where t2.b < 5 group by b)
select a,b,c,d1 from
cte1,
cte2,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
where cte1.a=cte2.b and cte2.b=dt1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (flat, BNL join)
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a > 2),
cte2 as (select * from t2 where t2.b < 5 group by b)
select a,b,c,d1 from
cte1,
cte2,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
where cte1.a=cte2.b and cte2.b=dt1.c;
a	b	c	d1
3	3	3	2
3	3	3	2
4	4	4	2
explain with
cte1 as (select * from t1 where t1.a > 2),
cte2 as (select * from t2 where t2.b < 5 group by b)
update
cte1,
cte2,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
set cte1.a=cte1.a+1, dt1.c=dt1.c-dt1.d1
where cte1.a=cte2.b and cte2.b=dt1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a > 2),
cte2 as (select * from t2 where t2.b < 5 group by b)
update
cte1,
cte2,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
set cte1.a=cte1.a+1, dt1.c=dt1.c-dt1.d1
where cte1.a=cte2.b and cte2.b=dt1.c;
select * from t1;
a
4
6
7
1
5
4
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
7	1
1	1
2	1
5	2
6	1
# update of join of mergeable cte1,
# non-mergeable cte2 and mergeable cte3
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select * from t2 where t2.b < 10 group by b),
cte3 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
cte2,
cte3
where cte1.a=cte2.b and cte2.b=cte3.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (flat, BNL join)
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select * from t2 where t2.b < 10 group by b),
cte3 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
cte2,
cte3
where cte1.a=cte2.b and cte2.b=cte3.c;
a	b	c	d1
7	7	7	2
6	6	6	2
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select * from t2 where t2.b < 10 group by b),
cte3 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
cte2,
cte3
set cte1.a=cte1.a-1, cte3.c=cte3.c+cte3.d1
where cte1.a=cte2.b and cte2.b=cte3.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select * from t2 where t2.b < 10 group by b),
cte3 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
cte2,
cte3
set cte1.a=cte1.a-1, cte3.c=cte3.c+cte3.d1
where cte1.a=cte2.b and cte2.b=cte3.c;
select * from t1;
a
4
5
6
1
5
4
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
9	1
1	1
2	1
5	2
8	1
# update of join of mergeable cte1,
# non-mergeable cte2 and mergeable view v1
create view v1 as select c, d+1 as d1 from t3 where t3.d in (1,2);
explain with
cte1 as (select * from t1 where t1.a < 3),
cte2 as (select * from t2 where t2.b < 5 group by b)
select a,b,c,d1 from
cte1,
cte2,
v1
where cte1.a=cte2.b and cte2.b=v1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (flat, BNL join)
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a < 3),
cte2 as (select * from t2 where t2.b < 5 group by b)
select a,b,c,d1 from
cte1,
cte2,
v1
where cte1.a=cte2.b and cte2.b=v1.c;
a	b	c	d1
2	2	2	2
1	1	1	2
1	1	1	2
2	2	2	2
explain with
cte1 as (select * from t1 where t1.a < 3),
cte2 as (select * from t2 where t2.b < 5 group by b)
update
cte1,
cte2,
v1
set cte1.a=cte1.a+1, v1.c=v1.c+v1.d1
where cte1.a=cte2.b and cte2.b=v1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a < 3),
cte2 as (select * from t2 where t2.b < 5 group by b)
update
cte1,
cte2,
v1
set cte1.a=cte1.a+1, v1.c=v1.c+v1.d1
where cte1.a=cte2.b and cte2.b=v1.c;
select * from t1;
a
4
5
6
2
5
4
5
3
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
4	1
3	1
2	3
9	1
3	1
4	1
5	2
8	1
drop view v1;
delete from t1;
delete from t2;
delete from t3;
insert into t1 values (3), (6), (7), (1), (4), (3), (5), (2);
insert into t2 values (5), (7), (3), (9), (2), (2), (4), (6), (1);
insert into t3 values
(4,2), (9,3), (2,1), (3,1), (2,3), (7,1), (1,1), (4,1), (5,2), (6,1);
select * from t1;
a
3
6
7
1
4
3
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
3	1
2	3
7	1
1	1
4	1
5	2
6	1
# update of join of mergeable cte1,
# non-mergeable view v1 and mergeable derived table dt1
create view v1 as (select * from t2 where t2.b < 5 group by b);
explain with cte1 as (select * from t1 where t1.a > 2)
select a,b,c,d1 from
cte1,
v1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
where cte1.a=v1.b and v1.b=dt1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (flat, BNL join)
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select * from t1 where t1.a > 2)
select a,b,c,d1 from
cte1,
v1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
where cte1.a=v1.b and v1.b=dt1.c;
a	b	c	d1
3	3	3	2
3	3	3	2
4	4	4	2
explain with cte1 as (select * from t1 where t1.a > 2)
update
cte1,
v1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
set cte1.a=cte1.a+1, dt1.c=dt1.c-dt1.d1
where cte1.a=v1.b and v1.b=dt1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select * from t1 where t1.a > 2)
update
cte1,
v1,
(select c, d+1 as d1 from t3 where t3.d = 1) dt1
set cte1.a=cte1.a+1, dt1.c=dt1.c-dt1.d1
where cte1.a=v1.b and v1.b=dt1.c;
select * from t1;
a
4
6
7
1
5
4
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
7	1
1	1
2	1
5	2
6	1
drop view v1;
# update of join of mergeable cte1,
# non-mergeable view v1 and mergeable cte2
create view v1 as select * from t2 where t2.b < 10 group by b;
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
v1,
cte2
where cte1.a=v1.b and v1.b=cte2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (flat, BNL join)
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
select a,b,c,d1 from
cte1,
v1,
cte2
where cte1.a=v1.b and v1.b=cte2.c;
a	b	c	d1
7	7	7	2
6	6	6	2
explain with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
v1,
cte2
set cte1.a=cte1.a-1, cte2.c=cte2.c+cte2.d1
where cte1.a=v1.b and v1.b=cte2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived4>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
4	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with
cte1 as (select * from t1 where t1.a > 5),
cte2 as (select c, d+1 as d1 from t3 where t3.d < 3)
update
cte1,
v1,
cte2
set cte1.a=cte1.a-1, cte2.c=cte2.c+cte2.d1
where cte1.a=v1.b and v1.b=cte2.c;
select * from t1;
a
4
5
6
1
5
4
5
2
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
2	1
1	1
2	3
9	1
1	1
2	1
5	2
8	1
drop view v1;
# update of join of mergeable cte1,
# non-mergeable view v1 and mergeable view v2
create view v1 as select * from t2 where t2.b < 5 group by b;
create view v2 as select c, d+1 as d1 from t3 where t3.d in (1,2);
explain with cte1 as (select * from t1 where t1.a < 3)
select a,b,c,d1 from
cte1,
v1,
v2
where cte1.a=v1.b and v1.b=v2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where; Using join buffer (flat, BNL join)
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select * from t1 where t1.a < 3)
select a,b,c,d1 from
cte1,
v1,
v2
where cte1.a=v1.b and v1.b=v2.c;
a	b	c	d1
2	2	2	2
1	1	1	2
1	1	1	2
2	2	2	2
explain with cte1 as (select * from t1 where t1.a < 3)
update
cte1,
v1,
v2
set cte1.a=cte1.a+1, v2.c=v2.c+v2.d1
where cte1.a=v1.b and v1.b=v2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	<derived3>	ref	key0	key0	5	test.t1.a	2	
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	10	Using where
3	DERIVED	t2	ALL	NULL	NULL	NULL	NULL	9	Using where; Using temporary; Using filesort
with cte1 as (select * from t1 where t1.a < 3)
update
cte1,
v1,
v2
set cte1.a=cte1.a+1, v2.c=v2.c+v2.d1
where cte1.a=v1.b and v1.b=v2.c;
select * from t1;
a
4
5
6
2
5
4
5
3
select * from t2;
b
5
7
3
9
2
2
4
6
1
select * from t3;
c	d
4	2
9	3
4	1
3	1
2	3
9	1
3	1
4	1
5	2
8	1
drop view v1;
drop view v2;
drop table t1,t2,t3;
