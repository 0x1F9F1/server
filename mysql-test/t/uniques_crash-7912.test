# MDEV-7912
# multitable delete with wrongly set sort_buffer_size crashes in merge_buffers
--source include/have_innodb.inc
set sql_mode="";
drop table if exists t1,t2;
create table `t1` (`a` datetime not null) engine=InnoDB;
create table `t2` (`a` int not null) engine=innodb;

replace into t1 values (),();
insert into t2 values(0);
set session sort_buffer_size = 1024*1024*1024*1024;
SET session debug_dbug= '+d,make_merge_buff_alloc_fail';
--error 5 #EE_OUTOFMEMORY
delete d2 from t2 as d1, t1 as d2 where d1.a <=> d2.a;
SET SESSION debug_dbug=DEFAULT;

drop table t2;
drop table t1;