create or replace table t(id int, s date, e date, val int,
                          period for p(s,e),
                          primary key(id, p without overlaps)) engine=myisam;

insert into t values (1, '2003-01-01', '2003-03-01', 1),
                     (1, '2003-05-01', '2003-07-01', 2);

--echo # This just inserts a row; no rows matched
insert into t values (2, '2003-01-01', '2003-04-01', 3)
       on duplicate key update val=4;

--sorted_result
select * from t;

insert into t values (1, '2003-01-05', '2003-04-01', 5)
       on duplicate key update val=6;
select row_count();
--sorted_result
select * from t;
insert into t values (1, '2003-01-01', '2003-06-01', 7)
       on duplicate key update val=8;
select row_count();
--sorted_result
select * from t;

--echo # No rows matched
insert into t values (1, '2003-07-01', '2003-08-01', 9)
       on duplicate key update val=10;
select row_count();
--sorted_result
select * from t;

replace into t values (1, '2003-02-01', '2003-05-05', 11);
select row_count();
--sorted_result
select * from t;

drop table t;
