# test that varchar changed with column rename work

--disable_warnings
DROP TABLE IF EXISTS t;
--enable_warnings

SET SESSION TOKUDB_DISABLE_SLOW_ALTER=ON;

CREATE TABLE t (a VARCHAR(100), b VARCHAR(256)) ENGINE=TokuDB;

# varchar shrink with column rename is not supported
--error ER_UNSUPPORTED_EXTENSION
ALTER TABLE t CHANGE COLUMN a aa VARCHAR(1);

# varchar expand with column rename is supported
ALTER TABLE t CHANGE COLUMN a aa VARCHAR(255);

# varchar column rename is supported
ALTER TABLE t CHANGE COLUMN aa a VARCHAR(255);

# varchar shrink woth column rename is not supported
--error ER_UNSUPPORTED_EXTENSION
ALTER TABLE t CHANGE COLUMN b bb VARCHAR(255);

# varchar expand with column rename is supported
ALTER TABLE t CHANGE COLUMN b bb VARCHAR(1024);

# varchar column rename is supported
ALTER TABLE t CHANGE COLUMN bb b VARCHAR(1024);

# varchar shrink with column rename is not supported
--error ER_UNSUPPORTED_EXTENSION
ALTER TABLE t CHANGE COLUMN b bb VARCHAR(256);

DROP TABLE t;