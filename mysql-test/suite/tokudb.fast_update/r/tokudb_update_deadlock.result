drop table if exists t;
set default_storage_engine='tokudb';
create table t (id bigint primary key, b bigint not null default 0);
insert into t (id) values (1),(2);
set session tokudb_enable_fast_update=1;
begin;
update t set b=b+1 where id=1;
set session tokudb_enable_fast_update=1;
begin;
update t set b=b-1 where id=2;
update t set b=b+1 where id=2;
update t set b=b-1 where id=1;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
rollback;
commit;
select * from t;
id	b
1	1
2	1
drop table t;
