SET STORAGE_ENGINE = 'tokudb';
# Establish connection conn1 (user = root)
# should see nothing
select DB, command, time, state, info from information_schema.processlist;
DB	command	time	state	info
test	Sleep	0		NULL
test	Sleep	0		NULL
test	Query	0	executing	select DB, command, time, state, info from information_schema.processlist
flush logs;
# should see nothing
select DB, command, time, state, info from information_schema.processlist;
DB	command	time	state	info
test	Sleep	0		NULL
test	Sleep	0		NULL
test	Query	0	executing	select DB, command, time, state, info from information_schema.processlist
set session tokudb_checkpoint_lock=1;
flush logs;;
# should see a flush logs
select DB, command, time, state, info from information_schema.processlist;
DB	command	time	state	info
test	Query	0	executing	select DB, command, time, state, info from information_schema.processlist
test	Sleep	2		NULL
test	Query	2	NULL	flush logs
set session tokudb_checkpoint_lock=1;
# should still see a flush logs
select DB, command, time, state, info from information_schema.processlist;
DB	command	time	state	info
test	Query	0	executing	select DB, command, time, state, info from information_schema.processlist
test	Sleep	2		NULL
test	Query	2	NULL	flush logs
set session tokudb_checkpoint_lock=0;
# should still see a flush logs
select DB, command, time, state, info from information_schema.processlist;
DB	command	time	state	info
test	Sleep	2		NULL
test	Query	0	executing	select DB, command, time, state, info from information_schema.processlist
test	Query	4	NULL	flush logs
set session tokudb_checkpoint_lock=0;
# should see nothing
select DB, command, time, state, info from information_schema.processlist;
DB	command	time	state	info
test	Query	0	executing	select DB, command, time, state, info from information_schema.processlist
test	Sleep	2		NULL
test	Sleep	6		NULL
