include/master-slave.inc
[connection master]
set global binlog_split_alter=true;
connection slave;
stop slave;
SET global slave_parallel_threads=2;
set global slave_parallel_mode=optimistic;
start slave;
connection master;
CREATE TABLE t1 (i int primary key) ENGINE = InnoDB;
connection master1;
ALTER  TABLE t1 DROP PRIMARY KEY;
ALTER  TABLE t1 ADD UNIQUE KEY ui (i);
ALTER  TABLE t1 ADD PRIMARY KEY (i);
ERROR 42000: Incorrect index name 'ui'
show binlog events;
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
master-bin.000001	4	Format_desc	1	256	Server ver: 10.5.0-MariaDB-debug-log, Binlog ver: 4
master-bin.000001	256	Gtid_list	1	285	[]
master-bin.000001	285	Binlog_checkpoint	1	329	master-bin.000001
master-bin.000001	329	Gtid	1	371	GTID 0-1-1
master-bin.000001	371	Query	1	489	use `test`; CREATE TABLE t1 (i int primary key) ENGINE = InnoDB
master-bin.000001	489	Gtid	1	531	GTID 0-1-2
master-bin.000001	531	Query	1	670	use `test`; /*!100001  ALTER  TABLE t1 DROP PRIMARY KEY EXECUTE = UNTIL COMMIT 10 */
master-bin.000001	670	Gtid	1	712	GTID 0-1-3
master-bin.000001	712	Query	1	844	use `test`; ALTER  TABLE t1 DROP PRIMARY KEY /*!100001 EXECUTE = COMMIT 10 */
master-bin.000001	844	Gtid	1	886	GTID 0-1-4
master-bin.000001	886	Query	1	1030	use `test`; /*!100001  ALTER  TABLE t1 ADD UNIQUE KEY ui (i) EXECUTE = UNTIL COMMIT 10 */
master-bin.000001	1030	Gtid	1	1072	GTID 0-1-5
master-bin.000001	1072	Query	1	1209	use `test`; ALTER  TABLE t1 ADD UNIQUE KEY ui (i) /*!100001 EXECUTE = COMMIT 10 */
master-bin.000001	1209	Gtid	1	1251	GTID 0-1-6
master-bin.000001	1251	Query	1	1393	use `test`; /*!100001  ALTER  TABLE t1 ADD PRIMARY KEY (i) EXECUTE = UNTIL COMMIT 10 */
master-bin.000001	1393	Gtid	1	1435	GTID 0-1-7
master-bin.000001	1435	Query	1	1573	use `test`; /*!100001  ALTER  TABLE t1 ADD PRIMARY KEY (i) EXECUTE = ROLLBACK 10 */
connection slave;
connection master;
drop table t1;
set global binlog_split_alter=false;
connection slave;
include/stop_slave.inc
SET global slave_parallel_threads=0;
set global slave_parallel_mode=conservative;
include/start_slave.inc
include/rpl_end.inc
