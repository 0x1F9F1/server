#
# Start Alter with binlog applied using mysqlbinlog
#
--source include/have_log_bin.inc
--source include/have_innodb.inc
--source include/master-slave.inc
--source include/have_debug.inc

--connection master
set global binlog_split_alter=true;
--connection slave
--source include/stop_slave.inc
change master to master_use_gtid= current_pos;
set global gtid_strict_mode=1;

--echo #Legacy Master Slave
--let $domain_1=0
--let $domain_2=0
--let $M_port= $MASTER_MYPORT
--let $S_port= $SLAVE_MYPORT
--let $sync_slave=0
#create table t1(a int);
#alter table t1 add column b int execute= UNTIL COMMIT 12;

--source include/start_alter_include.test
let MYSQLD_DATADIR= `select @@datadir;`;
--exec $MYSQL_BINLOG $MYSQLD_DATADIR/master-bin.000001 > $MYSQLTEST_VARDIR/tmp/master.sql
select @@gtid_binlog_state;
RESET master;

--connection slave
--exec $MYSQL --host=127.0.0.1 --port=$SLAVE_MYPORT -e "source $MYSQLTEST_VARDIR/tmp/master.sql"
select @@gtid_binlog_state;
set global gtid_strict_mode=0;
--source include/start_slave.inc

--connection master
set global binlog_split_alter=false;
--source include/rpl_end.inc
