--source include/have_log_bin.inc

SET @old_gtid_domain_id= @@global.gtid_domain_id;
SELECT @@global.gtid_domain_id;

SET GLOBAL gtid_domain_id= 10;
SET SESSION gtid_domain_id= 20;
SELECT @@global.gtid_domain_id;
SELECT @@session.gtid_domain_id;

SET GLOBAL gtid_domain_id= DEFAULT;
SELECT @@global.gtid_domain_id;

SET GLOBAL gtid_domain_id= -10;
SELECT @@global.gtid_domain_id;
SET SESSION gtid_domain_id= -1;
SELECT @@session.gtid_domain_id;

SET GLOBAL gtid_domain_id= @old_gtid_domain_id;

--echo #
--echo # 10.2 Test
--echo #
--echo # MDEV-22768: Assertion `! is_set() || m_can_overwrite_status'
--echo #             failed in Diagnostics_area::set_error_status
--echo #

SET @old_mode= @@sql_mode;
SET @old_autocommit=@@autocommit;
SET @old_init_connect= @@GLOBAL.init_connect;

USE test;
SET SQL_MODE='';
SET AUTOCOMMIT=0;
CREATE TABLE t(c CHAR (0));
SET STATEMENT gtid_domain_id=0 FOR INSERT INTO t VALUES(0),(0);
SET GLOBAL init_connect="SET @a=0";

DROP TABLE t;
SET @@sql_mode= @old_mode;
SET @@autocommit=@old_autocommit;
SET @@GLOBAL.init_connect= @old_init_connect;

--echo # End of 10.2 Test
