--source include/have_innodb.inc
--source include/have_debug.inc
--source include/have_sequence.inc

--let $cache= `select @@table_open_cache`
--let $adaptive= `select @@innodb_adaptive_hash_index`
--let $evict= `select @@innodb_evict_tables_on_commit_debug`
SET GLOBAL TABLE_OPEN_CACHE= 8,
        INNODB_ADAPTIVE_HASH_INDEX= 1,
        INNODB_EVICT_TABLES_ON_COMMIT_DEBUG= 1;

CREATE TABLE t1 (
  id INT AUTO_INCREMENT,
  a TIMESTAMP,
  b BINARY(132),
  PRIMARY KEY (a,b),
  KEY(id)
) ENGINE=InnoDB;

INSERT INTO t1 SELECT seq, '2012-12-12', CONCAT('s',seq) FROM seq_1_to_116;
CREATE TABLE t2 (pk INT PRIMARY KEY) ENGINE=InnoDB;
CREATE TABLE t3 (pk INT PRIMARY KEY) ENGINE=InnoDB;
CREATE TABLE t4 (pk INT PRIMARY KEY) ENGINE=InnoDB;
CREATE TABLE t5 (pk INT PRIMARY KEY) ENGINE=InnoDB;
CREATE TABLE t6 (pk INT PRIMARY KEY) ENGINE=InnoDB;
CREATE TABLE t7 (pk INT PRIMARY KEY) ENGINE=InnoDB;
CREATE TABLE t8 (pk INT PRIMARY KEY) ENGINE=InnoDB;

START TRANSACTION;
DELETE FROM t1;
INSERT INTO t2 VALUES (1);
INSERT INTO t3 VALUES (1);
INSERT INTO t4 VALUES (1);
INSERT INTO t5 VALUES (1);
INSERT INTO t6 VALUES (1);
INSERT INTO t7 VALUES (1);
INSERT INTO t8 VALUES (1);
COMMIT;
--source include/wait_all_purged.inc
# Cleanup
DROP TABLE t1, t2, t3, t4, t5, t6, t7, t8;
eval SET GLOBAL TABLE_OPEN_CACHE= $cache,
                INNODB_ADAPTIVE_HASH_INDEX= $adaptive,
                INNODB_EVICT_TABLES_ON_COMMIT_DEBUG= $evict;
