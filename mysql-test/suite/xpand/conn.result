call mtr.add_suppression("Cannot connect to xpand.*");
CREATE DATABASE xpd;
USE xpd;
CREATE TABLE t (i INT PRIMARY KEY) ENGINE=XPand;
CREATE TABLE u (i INT PRIMARY KEY);
INSERT INTO t VALUES (1);
INSERT INTO u VALUES (1);
SELECT * FROM t ORDER BY i;
i
1
SELECT * FROM u ORDER BY i;
i
1
SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_CATALOG	TABLE_SCHEMA	TABLE_NAME	TABLE_TYPE	ENGINE	VERSION	ROW_FORMAT	TABLE_ROWS	AVG_ROW_LENGTH	DATA_LENGTH	MAX_DATA_LENGTH	INDEX_LENGTH	DATA_FREE	AUTO_INCREMENT	CREATE_TIME	UPDATE_TIME	CHECK_TIME	TABLE_COLLATION	CHECKSUM	CREATE_OPTIONS	TABLE_COMMENT	MAX_INDEX_LENGTH	TEMPORARY
def	xpd	t	BASE TABLE	XPAND	10	Fixed	10000	0	0	0	0	0	NULL	NULL	NULL	NULL	utf8_general_ci	NULL			0	N
def	xpd	u	BASE TABLE	MyISAM	10	Fixed	1	7	7	1970324836974591	2048	0	NULL	2020-03-11 12:28:18	2020-03-11 12:28:18	NULL	latin1_swedish_ci	NULL			288230376151710720	N
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_CATALOG	TABLE_SCHEMA	TABLE_NAME	COLUMN_NAME	ORDINAL_POSITION	COLUMN_DEFAULT	IS_NULLABLE	DATA_TYPE	CHARACTER_MAXIMUM_LENGTH	CHARACTER_OCTET_LENGTH	NUMERIC_PRECISION	NUMERIC_SCALE	DATETIME_PRECISION	CHARACTER_SET_NAME	COLLATION_NAME	COLUMN_TYPE	COLUMN_KEY	EXTRA	PRIVILEGES	COLUMN_COMMENT	IS_GENERATED	GENERATION_EXPRESSION
def	xpd	t	i	1	NULL	NO	int	NULL	NULL	10	0	NULL	NULL	NULL	int(11)	PRI		select,insert,update,references		NEVER	NULL
def	xpd	u	i	1	NULL	NO	int	NULL	NULL	10	0	NULL	NULL	NULL	int(11)	PRI		select,insert,update,references		NEVER	NULL
SET @xpand_hosts = @@xpand_hosts;
SET @xpand_port = @@xpand_port;
SET GLOBAL xpand_hosts = CONCAT('notahost,', @xpand_hosts);
connect  conn2,localhost,root,,xpd;
connection conn2;
SHOW CREATE TABLE t;
Table	Create Table
t	CREATE TABLE `t` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=XPAND DEFAULT CHARSET=utf8
SHOW CREATE TABLE u;
Table	Create Table
u	CREATE TABLE `u` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1
INSERT INTO t values (2);
INSERT INTO u values (2);
SELECT * FROM t ORDER BY i;
i
1
2
SELECT * FROM u ORDER BY i;
i
1
2
SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_CATALOG	TABLE_SCHEMA	TABLE_NAME	TABLE_TYPE	ENGINE	VERSION	ROW_FORMAT	TABLE_ROWS	AVG_ROW_LENGTH	DATA_LENGTH	MAX_DATA_LENGTH	INDEX_LENGTH	DATA_FREE	AUTO_INCREMENT	CREATE_TIME	UPDATE_TIME	CHECK_TIME	TABLE_COLLATION	CHECKSUM	CREATE_OPTIONS	TABLE_COMMENT	MAX_INDEX_LENGTH	TEMPORARY
def	xpd	t	BASE TABLE	XPAND	10	Fixed	10000	0	0	0	0	0	NULL	NULL	NULL	NULL	utf8_general_ci	NULL			0	N
def	xpd	u	BASE TABLE	MyISAM	10	Fixed	2	7	14	1970324836974591	2048	0	NULL	2020-03-11 12:28:18	2020-03-11 12:28:18	NULL	latin1_swedish_ci	NULL			288230376151710720	N
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_CATALOG	TABLE_SCHEMA	TABLE_NAME	COLUMN_NAME	ORDINAL_POSITION	COLUMN_DEFAULT	IS_NULLABLE	DATA_TYPE	CHARACTER_MAXIMUM_LENGTH	CHARACTER_OCTET_LENGTH	NUMERIC_PRECISION	NUMERIC_SCALE	DATETIME_PRECISION	CHARACTER_SET_NAME	COLLATION_NAME	COLUMN_TYPE	COLUMN_KEY	EXTRA	PRIVILEGES	COLUMN_COMMENT	IS_GENERATED	GENERATION_EXPRESSION
def	xpd	t	i	1	NULL	NO	int	NULL	NULL	10	0	NULL	NULL	NULL	int(11)	PRI		select,insert,update,references		NEVER	NULL
def	xpd	u	i	1	NULL	NO	int	NULL	NULL	10	0	NULL	NULL	NULL	int(11)	PRI		select,insert,update,references		NEVER	NULL
disconnect conn2;
connection default;
SET GLOBAL xpand_hosts = '127.0.0.1';
SET GLOBAL xpand_port = 1;
connect  conn3,localhost,root,,xpd;
connection conn3;
SHOW CREATE TABLE t;
Table	Create Table
t	CREATE TABLE `t` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=XPAND DEFAULT CHARSET=utf8
SHOW CREATE TABLE u;
Table	Create Table
u	CREATE TABLE `u` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1
INSERT INTO t values (3);
ERROR HY000: Got error 157 "Could not connect to the storage engine" from storage engine XPAND
INSERT INTO u values (3);
SELECT * FROM t ORDER BY i;
ERROR HY000: Got error 157 "Could not connect to the storage engine" from storage engine XPAND
SELECT * FROM u ORDER BY i;
i
1
2
3
SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_CATALOG	TABLE_SCHEMA	TABLE_NAME	TABLE_TYPE	ENGINE	VERSION	ROW_FORMAT	TABLE_ROWS	AVG_ROW_LENGTH	DATA_LENGTH	MAX_DATA_LENGTH	INDEX_LENGTH	DATA_FREE	AUTO_INCREMENT	CREATE_TIME	UPDATE_TIME	CHECK_TIME	TABLE_COLLATION	CHECKSUM	CREATE_OPTIONS	TABLE_COMMENT	MAX_INDEX_LENGTH	TEMPORARY
def	xpd	u	BASE TABLE	MyISAM	10	Fixed	3	7	21	1970324836974591	2048	0	NULL	2020-03-11 12:28:18	2020-03-11 12:28:18	NULL	latin1_swedish_ci	NULL			288230376151710720	N
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_CATALOG	TABLE_SCHEMA	TABLE_NAME	COLUMN_NAME	ORDINAL_POSITION	COLUMN_DEFAULT	IS_NULLABLE	DATA_TYPE	CHARACTER_MAXIMUM_LENGTH	CHARACTER_OCTET_LENGTH	NUMERIC_PRECISION	NUMERIC_SCALE	DATETIME_PRECISION	CHARACTER_SET_NAME	COLLATION_NAME	COLUMN_TYPE	COLUMN_KEY	EXTRA	PRIVILEGES	COLUMN_COMMENT	IS_GENERATED	GENERATION_EXPRESSION
def	xpd	u	i	1	NULL	NO	int	NULL	NULL	10	0	NULL	NULL	NULL	int(11)	PRI		select,insert,update,references		NEVER	NULL
disconnect conn3;
connection default;
SET GLOBAL xpand_hosts = @xpand_hosts;
SET GLOBAL xpand_port = @xpand_port;
SHOW CREATE TABLE t;
Table	Create Table
t	CREATE TABLE `t` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=XPAND DEFAULT CHARSET=utf8
SHOW CREATE TABLE u;
Table	Create Table
u	CREATE TABLE `u` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1
INSERT INTO t VALUES (4);
INSERT INTO u VALUES (4);
SELECT * FROM t ORDER BY i;
i
1
2
4
SELECT * FROM u ORDER BY i;
i
1
2
3
4
SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_CATALOG	TABLE_SCHEMA	TABLE_NAME	TABLE_TYPE	ENGINE	VERSION	ROW_FORMAT	TABLE_ROWS	AVG_ROW_LENGTH	DATA_LENGTH	MAX_DATA_LENGTH	INDEX_LENGTH	DATA_FREE	AUTO_INCREMENT	CREATE_TIME	UPDATE_TIME	CHECK_TIME	TABLE_COLLATION	CHECKSUM	CREATE_OPTIONS	TABLE_COMMENT	MAX_INDEX_LENGTH	TEMPORARY
def	xpd	t	BASE TABLE	XPAND	10	Fixed	10000	0	0	0	0	0	NULL	NULL	NULL	NULL	utf8_general_ci	NULL			0	N
def	xpd	u	BASE TABLE	MyISAM	10	Fixed	4	7	28	1970324836974591	2048	0	NULL	2020-03-11 12:28:18	2020-03-11 12:28:18	NULL	latin1_swedish_ci	NULL			288230376151710720	N
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_CATALOG	TABLE_SCHEMA	TABLE_NAME	COLUMN_NAME	ORDINAL_POSITION	COLUMN_DEFAULT	IS_NULLABLE	DATA_TYPE	CHARACTER_MAXIMUM_LENGTH	CHARACTER_OCTET_LENGTH	NUMERIC_PRECISION	NUMERIC_SCALE	DATETIME_PRECISION	CHARACTER_SET_NAME	COLLATION_NAME	COLUMN_TYPE	COLUMN_KEY	EXTRA	PRIVILEGES	COLUMN_COMMENT	IS_GENERATED	GENERATION_EXPRESSION
def	xpd	t	i	1	NULL	NO	int	NULL	NULL	10	0	NULL	NULL	NULL	int(11)	PRI		select,insert,update,references		NEVER	NULL
def	xpd	u	i	1	NULL	NO	int	NULL	NULL	10	0	NULL	NULL	NULL	int(11)	PRI		select,insert,update,references		NEVER	NULL
USE test;
DROP DATABASE xpd;
