call mtr.add_suppression("Cannot connect to xpand.*");
CREATE DATABASE xpd;
USE xpd;
CREATE TABLE t (i INT PRIMARY KEY) ENGINE=XPand;
CREATE TABLE u (i INT PRIMARY KEY);
INSERT INTO t VALUES (1);
INSERT INTO u VALUES (1);
SELECT * FROM t ORDER BY i;
i
1
SELECT * FROM u ORDER BY i;
i
1
SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_SCHEMA	TABLE_NAME
xpd	t
xpd	u
SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_SCHEMA	TABLE_NAME
xpd	t
xpd	u
SET @xpand_hosts = @@xpand_hosts;
SET @xpand_port = @@xpand_port;
SET GLOBAL xpand_hosts = CONCAT('notahost,', @xpand_hosts);
connect  conn2,localhost,root,,xpd;
connection conn2;
SHOW CREATE TABLE t;
Table	Create Table
t	CREATE TABLE `t` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=XPAND DEFAULT CHARSET=utf8
SHOW CREATE TABLE u;
Table	Create Table
u	CREATE TABLE `u` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1
INSERT INTO t values (2);
INSERT INTO u values (2);
SELECT * FROM t ORDER BY i;
i
1
2
SELECT * FROM u ORDER BY i;
i
1
2
SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_SCHEMA	TABLE_NAME
xpd	t
xpd	u
SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_SCHEMA	TABLE_NAME
xpd	t
xpd	u
disconnect conn2;
connection default;
SET GLOBAL xpand_hosts = '127.0.0.1';
SET GLOBAL xpand_port = 1;
connect  conn3,localhost,root,,xpd;
connection conn3;
SHOW CREATE TABLE t;
Table	Create Table
t	CREATE TABLE `t` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=XPAND DEFAULT CHARSET=utf8
SHOW CREATE TABLE u;
Table	Create Table
u	CREATE TABLE `u` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1
INSERT INTO t values (3);
ERROR HY000: Got error 157 "Could not connect to the storage engine" from storage engine XPAND
INSERT INTO u values (3);
SELECT * FROM t ORDER BY i;
ERROR HY000: Got error 157 "Could not connect to the storage engine" from storage engine XPAND
SELECT * FROM u ORDER BY i;
i
1
2
3
SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_SCHEMA	TABLE_NAME
xpd	u
SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_SCHEMA	TABLE_NAME
xpd	u
disconnect conn3;
connection default;
SET GLOBAL xpand_hosts = @xpand_hosts;
SET GLOBAL xpand_port = @xpand_port;
SHOW CREATE TABLE t;
Table	Create Table
t	CREATE TABLE `t` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=XPAND DEFAULT CHARSET=utf8
SHOW CREATE TABLE u;
Table	Create Table
u	CREATE TABLE `u` (
  `i` int(11) NOT NULL,
  PRIMARY KEY (`i`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1
INSERT INTO t VALUES (4);
INSERT INTO u VALUES (4);
SELECT * FROM t ORDER BY i;
i
1
2
4
SELECT * FROM u ORDER BY i;
i
1
2
3
4
SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_SCHEMA	TABLE_NAME
xpd	t
xpd	u
SELECT TABLE_SCHEMA, TABLE_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'xpd' AND TABLE_NAME IN ('t', 'u') ORDER BY TABLE_SCHEMA, TABLE_NAME;
TABLE_SCHEMA	TABLE_NAME
xpd	t
xpd	u
USE test;
DROP DATABASE xpd;
