set storage_engine='tokudb';

--disable_warnings
drop table if exists t;
--enable_warnings

connect(conn1,localhost);

connection default;
create table t (a int primary key, b int);
insert into t values (1,0),(2,1),(3,0);
set tokudb_use_write_locks=1;
begin;
delete from t where b>0;

connection conn1;
set transaction isolation level serializable;
send select * from t where a!=2;

connection default;
commit;

connection conn1;
reap;

connection default;
disconnect conn1;

drop table t;
